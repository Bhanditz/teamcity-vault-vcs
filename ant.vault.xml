<!--
  ~ Copyright 2000-2013 JetBrains s.r.o.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<project name="download Vault API" default="prepare.vault.api.6_1.and.7_0" basedir=".">

  <target name="prepare.vault.api.6_1.and.7_0">
    <antcall target="prepare.vault.api">
      <param name="path.variable.vaultapi" value="${basedir}/vaultAPI_6_1"/>
      <param name="vault.java.clc.url" value="http://download-us.sourcegear.com/VaultPro/6.1.0.30531/vaultproJavaCLC_6_1_0_30531.zip"/>
    </antcall>

    <antcall target="prepare.vault.api">
      <param name="path.variable.vaultapi" value="${basedir}/vaultAPI_7_0"/>
      <param name="vault.java.clc.url" value="http://download-us.sourcegear.com/VaultPro/7.0.0.30548/vaultproJavaCLC_7_0_0_30548.zip"/>
    </antcall>
  </target>

  <target name="prepare.vault.api" depends="check.vault.api.present, get.vault.api.if.necessary"/>

  <target name="check.vault.api.present" if="path.variable.vaultapi">
    <condition property="vault.api.not.present">
      <not>
        <and>
          <available file="${path.variable.vaultapi}/VaultClientIntegrationLib.jar"/>
        </and>
      </not>
    </condition>
  </target>

  <target name="get.vault.api.if.necessary" if="vault.api.not.present">
    <echo message="Vault API is not found at ${path.variable.vaultapi}, will download."/>
    <antcall target="get.vault.api"/>
  </target>

  <target name="get.vault.api">
    <echo message="Downloading Vault API from SourceGear site, this can take a while..."/>

    <property name="vault.java.clc" value="${basedir}/vault_java_clc"/>
    <delete dir="${vault.java.clc}"/>
    <mkdir dir="${vault.java.clc}"/>

    <get dest="${vault.java.clc}" verbose="true">
      <url url="${vault.java.clc.url}"/>
    </get>

    <unzip dest="${vault.java.clc}">
      <fileset dir="${vault.java.clc}">
        <include name="*.zip"/>
      </fileset>
    </unzip>

    <copy todir="${path.variable.vaultapi}" overwrite="true" flatten="true">
      <fileset dir="${vault.java.clc}">
        <include name="*/lib/*.jar"/>
      </fileset>
    </copy>

    <delete dir="${vault.java.clc}"/>
    <echo message="Vault API prepared in ${path.variable.vaultapi}"/>
  </target>

</project>